(function(exports,undefined){"use strict";var _voidElements=["area","base","br","col","embed","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"];var Vis=function(obj,block){return Vis.create(obj,block)};Vis.version=.1;Vis.blocks={};Vis.create=function(obj,block){if(typeof Vis.blocks[block]==="undefined"){Vis.error("Non-existent block "+block)}var v=Object.create(Vis.blocks[block]);if(typeof v.init!=="undefined"){v.init(obj,block)}return v};Vis.error=function(msg){throw new Error(msg)};Vis.render=function(data){if(data instanceof Array){var html="";for(var i=0;i<data.length;++i){html+=Vis.render(data[i])}return html}else if(data instanceof Object){var tag=data.tag||"div";var attrs=data.attrs||{};var html="<"+tag;if(data.cls||attrs["class"]){var v=[];data.cls&&v.push(data.cls);attrs["class"]&&v.push(attrs["class"]);html+=' class="'+v.join(" ")+'"'}for(var attr in attrs){if(attr==="class"){continue}if(attrs.hasOwnProperty(attr)){html+=" "+attr+'="'+attrs[attr]+'"'}}html+=">";if(data.content||_voidElements.indexOf(tag)==-1){html+=Vis.render(data.content||"");html+="</"+tag+">"}return html}else{return data}};Vis.extend=function(base,mix){var result=Object.create(base);result.__base=base;for(var i in mix){if(mix.hasOwnProperty(i)){result[i]=mix[i]}}return result};exports.Vis=Vis})(window);(function(Vis){var _prefix="Vis-"+ +new Date+"-";var _id=0;Vis.uniqId=function(){_id+=1;return _prefix+_id}})(window.Vis);(function(exports){"use strict";var TaskScheduler={tasks:[],byId:{},minPrio:null,currentPrio:null,currentTask:null,lastTimeout:null,PRIO_SYSTEM:-5,PRIO_DATA:0,PRIO_UI:5,collectTime:10,lockTime:50};TaskScheduler._findPrioBlock=function(prio){var tasks=this.tasks;var prioBlock;for(var i=0,l=tasks.length;i<l;++i){if(tasks[i].prio==prio){prioBlock=tasks[i];break}if(tasks[i].prio>prio){prioBlock={prio:prio,queue:[],revQueue:[],delayedQueue:[]};tasks.splice(i,0,prioBlock);break}}if(!prioBlock){prioBlock={prio:prio,queue:[],revQueue:[],delayedQueue:[]};tasks.push(prioBlock)}return prioBlock};TaskScheduler._isMaskReady=function(mask){for(var i=0,l=mask.length;i<l;++i){if(!mask[i]){return false}}return true};TaskScheduler.run=function(prio,subtasks,context,feature){context=context||{};if(context.delay){context.startTime=new Date(+new Date+context.delay);if(context.features){context.mask=new Array(context.features);if(typeof feature!=="undefined"){context.mask[feature]=true}if(this._isMaskReady(context.mask)){context.startTime=new Date(0)}}}if(context.id&&this.byId[context.id]){var task=this.byId[context.id];if(!context.startTime&&task.context.startTime){context.startTime=new Date(0)}task.subtasks=subtasks.slice();task.context=context;task.reset=true;return}var prioBlock=this._findPrioBlock(prio);var newTask={subtasks:subtasks.slice(),context:context};if(context.startTime){prioBlock.delayedQueue.push(newTask)}else{prioBlock.queue.push(newTask)}if(context.id){this.byId[context.id]=newTask}if(this.minPrio===null||prio<this.minPrio){this.minPrio=prio}if(this.currentTask===null){this.waitForNextTask()}};TaskScheduler.update=function(prio,subtasks,context,feature){context=context||{};if(context.delay){context.startTime=new Date(+new Date+context.delay)}if(context.id&&this.byId[context.id]){var task=this.byId[context.id];var mask=task.context.mask;var resetTimer=false;task.context=context;if(mask&&typeof feature!=="undefined"){mask[feature]=true;if(this._isMaskReady(context.mask)){task.context.startTime=new Date(0);resetTimer=true}}task.context.mask=mask;if(resetTimer&&this.currentTask===null){this.waitForNextTask()}}else{this.run(prio,subtasks,context,feature)}};TaskScheduler._nextTask=function(finished){finished=typeof finished==="undefined"?true:finished;if(finished&&this.currentTask&&this.currentTask.context.id){delete this.byId[this.currentTask.context.id]}var tasks=this.tasks;var prioBlock;for(var i=0,l=tasks.length;i<l;++i){if(tasks[i].delayedQueue.length>0){var queue=tasks[i].delayedQueue,now=+new Date,j=0;while(j<queue.length){if(+queue[j].context.startTime<=now){var x=queue.splice(j,1);tasks[i].revQueue.push(x[0])}else{++j}}}if(tasks[i].queue.length>0||tasks[i].revQueue.length>0){prioBlock=tasks[i];break}}if(!prioBlock){this.minPrio=null;this.currentPrio=null;this.currentTask=null;return false}if(prioBlock.revQueue.length===0){var q=prioBlock.queue,rq=prioBlock.revQueue,len=q.length;while(len--)rq.push(q.pop())}this.minPrio=prioBlock.prio;this.currentPrio=prioBlock.prio;this.currentTask=prioBlock.revQueue.pop();return true};TaskScheduler.next=function(func){if(this.currentTask!==null&&this.currentTask.reset){func=void 0;delete this.currentTask.reset}var nextFunc;if(this.minPrio!==null&&this.currentPrio!==null&&this.minPrio<this.currentPrio){if(typeof func!=="undefined"){this.currentTask.subtasks.unshift(func)}var currentPrioBlock=this._findPrioBlock(this.currentPrio);currentPrioBlock.revQueue.push(this.currentTask);this._nextTask(false)}else{nextFunc=func}if(typeof nextFunc==="undefined"){while(this.currentTask===null||this.currentTask.subtasks.length===0){if(!this._nextTask()){break}}if(this.currentTask!==null){nextFunc=this.currentTask.subtasks.shift()}}if(typeof nextFunc!=="undefined"){var _this=this;var context=this.currentTask&&this.currentTask.context||{};var args=[_this].concat(context.args||[]);if(_this.lastTimeout===null){_this.lastTimeout=new Date}if(+new Date-+this.lastTimeout>this.lockTime){console.log("locked for",+new Date-+this.lastTimeout,"ms; releasing for events collecting...");setTimeout(function(){_this.lastTimeout=new Date;nextFunc.apply(_this,args)},_this.collectTime)}else{nextFunc.apply(_this,args)}}else{console.log("locked for ",+new Date-+this.lastTimeout,"ms");this.waitForNextTask()}};TaskScheduler._waitTimeForPrioBlock=function(prioBlock,now){if(prioBlock.queue.length>0||prioBlock.revQueue.length>0){return null}var waitTime;for(var i=0,l=prioBlock.delayedQueue.length;i<l;++i){var task=prioBlock.delayedQueue[i];var taskWaitTime=+task.context.startTime-now;if(typeof waitTime==="undefined"||taskWaitTime<waitTime){waitTime=taskWaitTime}}return waitTime};TaskScheduler.waitForNextTask=function(){var _this=this,tasks=_this.tasks,waitTime,now=+new Date;for(var i=0,l=tasks.length;i<l;++i){var blockWaitTime=_this._waitTimeForPrioBlock(tasks[i],now);if(blockWaitTime===null){waitTime=0}else if(typeof waitTime==="undefined"||blockWaitTime<waitTime){waitTime=blockWaitTime}if(waitTime<=0){break}}if(_this.waitTimeout){clearTimeout(_this.waitTimeout);delete _this.waitTimeout}if(waitTime<=0){_this.lastTimeout=new Date;_this.next()}else if(typeof waitTime!=="undefined"){_this.waitTimeout=setTimeout(function(){_this.lastTimeout=new Date;_this.next()},waitTime)}};exports.TaskScheduler=TaskScheduler})(window);(function(exports){"use strict";var Units={siUnits:["A","V","Hz"],binaryUnits:["bit","bits","b","byte","bytes","Byte","Bytes","B"]};Units.getPrefix=function(value,unit){return{value:value,volume:1e3}};Units.format=function(value,units,scale){if(units=="unixtime"){var d=new Date(value*1e3),hh=d.getHours(),mm=d.getMinutes(),ss=d.getSeconds();if(hh<10)hh="0"+hh;if(mm<10)mm="0"+mm;if(ss<10)ss="0"+ss;return hh+":"+mm+":"+ss}else{return scale.format(value)}};Units.formatTicks=function(ticks,units,scale){var labeledTicks=[];var i,l,tickValue;if(units=="unixtime"){for(i=0,l=ticks.length;i<l;++i){tickValue=ticks[i];var labeledTick={tickValue:tickValue,label:this.format(tickValue,units,scale)};var d=new Date(ticks[i]*1e3);if(i===0||new Date(ticks[i-1]*1e3).getDate()!==d.getDate()){labeledTick.extraLabel=d.getDate()+"."+(d.getMonth()+1)+"."+d.getFullYear()}labeledTicks.push(labeledTick)}}else{for(i=0,l=ticks.length;i<l;++i){tickValue=ticks[i];labeledTicks.push({tickValue:tickValue,label:this.format(tickValue,units,scale)})}}return labeledTicks};exports.Units=Units})(window);(function(Vis){Vis.binarySearch=function binarySearch(value,arr){var low=0,high=arr.length-1,mid,midValue;if(low>high){return-1}while(low<=high){mid=low+high>>1;midValue=arr[mid];if(value<midValue){high=mid-1}else if(value>midValue){low=mid+1}else{return mid}}return-low-1}})(Vis);(function($){$.colorToRgba=function(colorStr){var match;match=colorStr.match(/^rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/);if(match!==null){return{r:parseInt(match[1],10),g:parseInt(match[2],10),b:parseInt(match[3],10),a:1}}match=colorStr.match(/^rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*((?:\d+)?(?:\.\d+)?)\s*\)$/);if(match!==null){return{r:parseInt(match[1],10),g:parseInt(match[2],10),b:parseInt(match[3],10),a:parseFloat(match[4])}}match=colorStr.match(/^#([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);if(match!==null){return{r:parseInt(match[1],16),g:parseInt(match[2],16),b:parseInt(match[3],16),a:1}}match=colorStr.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(match!==null){return{r:parseInt(match[1]+match[1],16),g:parseInt(match[2]+match[2],16),b:parseInt(match[3]+match[3],16),a:1}}return{r:0,g:0,b:0,a:1}}})(jQuery);(function(Vis){"use strict";Vis.blocks["b-axis"]={init:function($object){this.$object=$object},update:function(position,ticks){var offsets={left:"top",right:"top",top:"left",bottom:"left"};var content="";var offset=offsets[position]||"top";for(var i=0;i<ticks.length;++i){var tick=ticks[i];content+=Vis.render({cls:"b-axis__value",attrs:{style:offset+":"+tick.offset+"px"},content:[{cls:"b-axis__label",content:tick.label+(tick.extraLabel?"<br>"+tick.extraLabel:"")},{cls:"b-axis__tick"}]})}this.$object.attr("class","b-axis b-axis_pos_"+position);this.$object.html(content)}}})(window.Vis);(function($,Vis){"use strict";var busyDelay=2500;Vis.blocks["i-chart"]={init:function(params){var _this=this;_this.dimensions={width:0,height:0};params=params||{};_this.title=params.title||"";var colorScheme=params.colorScheme||{};_this.colorScheme=Vis.create(colorScheme,colorScheme.name||"i-tango-color-scheme");_this.content={tAxes:params.tAxes||[],xAxes:params.xAxes||[],yAxes:params.yAxes||[],items:params.items||[],overlays:params.overlays||[],layers:[]};_this._initContent()},initTAxis:function(tAxisNo){},_initTAxis:function(tAxisNo){var _this=this,tAxis=_this.content.tAxes[tAxisNo];tAxis.rangeProvider=Vis.create(tAxis.rangeProvider,tAxis.rangeProvider.name||"undefined-t-range-provider");_this.initTAxis(tAxisNo);tAxis.rangeProvider.on("update",function(){_this._updateTAxisRange(tAxisNo)});_this._updateTAxisRange(tAxisNo)},updateTAxisRange:function(tAxisNo){},_updateTAxisRange:function(tAxisNo){var _this=this,tAxis=_this.content.tAxes[tAxisNo],range=tAxis.rangeProvider.get(),scale=tAxis.scale||{},items=_this.content.items;_this.updateTAxisRange(tAxisNo);if(range.min==scale.inputMin&&range.max==scale.inputMax){return}tAxis.scale={inputMin:range.min,inputMax:range.max};_this.updateTAxisRange(tAxisNo)},initTAxes:function(){},_initTAxes:function(){var _this=this,tAxes=_this.content.tAxes;for(var tAxisNo=0,l=tAxes.length;tAxisNo<l;++tAxisNo){_this._initTAxis(tAxisNo)}_this.initTAxes()},_initItem:function(itemNo){var _this=this,tAxes=_this.content.tAxes,xAxes=_this.content.xAxes,yAxes=_this.content.yAxes,item=_this.content.items[itemNo];if(tAxes.length>0){item.tAxis=tAxes[item.tAxisNo||0]||Vis.error("No t-axis for item #"+itemNo)}if(typeof item.xAxisNo==="undefined"){item.xAxisNo=0}item.xAxis=xAxes[item.xAxisNo]||Vis.error("No x-axis for item #"+itemNo);if(typeof item.yAxisNo==="undefined"){item.yAxisNo=0}item.yAxis=yAxes[item.yAxisNo]||Vis.error("No y-axis for item #"+itemNo);if(typeof item.color==="undefined"){item.color=_this.colorScheme.get(itemNo)}if(typeof item.units==="undefined"){item.units=""}if(typeof item.dataProvider.timeRangeProvider==="undefined"&&item.tAxis){item.dataProvider.timeRangeProvider=item.tAxis.rangeProvider}item.dataProvider=Vis.create(item.dataProvider,item.dataProvider.name||"undefined-item-data-provider");item.dataProvider.on("update",function(e){_this._updateItemData(itemNo)});if(!item.filters){item.filters=[]}for(var i=0,l=item.filters.length;i<l;++i){item.filters[i]=Vis.create(item.filters[i],item.filters[i].name)}item.on=function(action,callback){$(item).on(action+".vis",callback)};item.trigger=function(action){$(item).trigger(action+".vis")};item.renderData={};_this._updateItemData(itemNo)},_updateItemData:function(itemNo){var _this=this,item=_this.content.items[itemNo],filters=item.filters;item.rawData=item.dataProvider.get();var data={};$.each(item.rawData,function(name,arr){data[name]=arr.slice()});for(var i=0,l=filters.length;i<l;++i){data=filters[i].run(item,data)}item.data=data;item.trigger("data");this.render()},_initItems:function(){var _this=this,items=_this.content.items;for(var itemNo=0,l=items.length;itemNo<l;++itemNo){_this._initItem(itemNo)}},_initXYAxis:function(xy,XY,pos,no){var _this=this,tAxes=_this.content.tAxes,items=_this.content.items,axis=_this.content[xy+"Axes"][no],i,l;var scale=axis.scale||{};axis.scale=Vis.create(scale,scale.name||"i-scale-linear");if(typeof axis.units==="undefined"){axis.units=""}var validPos=false;for(i=0,l=pos.length;i<l;++i){if(axis.pos===pos[i]){validPos=true;break}}if(!validPos){axis.pos=pos[0]}var axisItems=[];for(i=0,l=items.length;i<l;++i){var item=items[i];if(item[xy+"AxisNo"]!=no)continue;axisItems.push(item)}axis.items=axisItems;if(tAxes.length>0){axis.tAxis=tAxes[axis.tAxisNo||0]||Vis.error("No t-axis for "+xy+"-axis #"+no)}if(typeof axis.rangeProvider.timeRangeProvider==="undefined"&&axis.tAxis){axis.rangeProvider.timeRangeProvider=axis.tAxis.rangeProvider}if(typeof axis.rangeProvider.xy==="undefined"){axis.rangeProvider.xy=xy}if(typeof axis.rangeProvider.items==="undefined"){axis.rangeProvider.items=axisItems}axis.rangeProvider=Vis.create(axis.rangeProvider,axis.rangeProvider.name||"undefined-y-range-provider");if(typeof axis.processors==="undefined"){axis.processors=[]}for(i=0,l=axis.processors.length;i<l;++i){var processor=axis.processors[i];processor.dimensions=_this.dimensions;processor.content=_this.content;axis.processors[i]=Vis.create(processor,processor.name)}_this["init"+XY+"Axis"](no);axis.rangeProvider.on("update",function(){_this["_update"+XY+"AxisRange"](no)});_this["_update"+XY+"AxisRange"](no)},_updateXYAxisRange:function(xy,XY,no){var _this=this,axis=_this.content[xy+"Axes"][no],range=axis.rangeProvider.get(),scale=axis.scale;if(range.min==scale.inputMin&&range.max==scale.inputMax){return}scale.input(range.min,range.max);_this["update"+XY+"AxisRange"](no);_this["_render"+XY+"Axis"](no)},_renderXYAxis:function(xy,XY,no,n,a,b){var _this=this,axis=this.content[xy+"Axes"][no];axis.ticks=axis.scale.ticks(n,axis.units);var ticks=Units.formatTicks(axis.ticks,axis.units,axis.scale);for(var i=0,l=ticks.length;i<l;++i){var tick=ticks[i];tick.offset=b+a*Math.round(axis.scale.f(tick.tickValue))}_this["render"+XY+"Axis"](no,ticks);this.render()},initXAxis:function(xAxisNo){},_initXAxis:function(xAxisNo){this._initXYAxis("x","X",["bottom","top"],xAxisNo)},updateXAxisRange:function(xAxisNo){},_updateXAxisRange:function(xAxisNo){this._updateXYAxisRange("x","X",xAxisNo)},renderXAxis:function(xAxisNo,ticks){},_renderXAxis:function(xAxisNo){this._renderXYAxis("x","X",xAxisNo,Math.floor(this.dimensions.width/65),1,0)},initXAxes:function(){},_initXAxes:function(){var _this=this,xAxes=_this.content.xAxes;for(var xAxisNo=0,l=xAxes.length;xAxisNo<l;++xAxisNo){_this._initXAxis(xAxisNo)}_this.initXAxes()},initYAxis:function(yAxisNo){},_initYAxis:function(yAxisNo){this._initXYAxis("y","Y",["right","left"],yAxisNo)},updateYAxisRange:function(yAxisNo){},_updateYAxisRange:function(yAxisNo){this._updateXYAxisRange("y","Y",yAxisNo)},renderYAxis:function(yAxisNo,ticks){},_renderYAxis:function(yAxisNo){this._renderXYAxis("y","Y",yAxisNo,Math.floor(this.dimensions.height/40),-1,this.dimensions.height-1)},initYAxes:function(){},_initYAxes:function(){var _this=this,yAxes=_this.content.yAxes;for(var yAxisNo=0,l=yAxes.length;yAxisNo<l;++yAxisNo){_this._initYAxis(yAxisNo)}_this.initYAxes()},initOverlay:function(overlayNo){},_initOverlay:function(overlayNo){var _this=this,overlays=_this.content.overlays,overlay=overlays[overlayNo];overlay.dimensions=_this.dimensions;overlay.content=_this.content;overlays[overlayNo]=Vis.create(overlay,overlay.name||"undefined-overlay");_this.initOverlay(overlayNo)},_initOverlays:function(){var _this=this,overlays=_this.content.overlays;for(var i=0,l=overlays.length;i<l;++i){_this._initOverlay(i)}},initContent:function(){},_initContent:function(){this._initTAxes();this._initItems();this._initXAxes();this._initYAxes();this._initOverlays();this.initContent()},applySize:function(){},_applySize:function(){var _this=this,dim=_this.dimensions,xAxes=_this.content.xAxes,yAxes=_this.content.yAxes,i,l;for(i=0,l=xAxes.length;i<l;++i){xAxes[i].scale.output(0,dim.width-1)}for(i=0,l=yAxes.length;i<l;++i){yAxes[i].scale.output(0,dim.height-1)}_this.applySize()},_updateItem:function(itemNo){var _this=this,item=_this.content.items[itemNo];_this._updateItemData(item);item.ready=true;_this.renderItem(itemNo)},_requestItemData:function(item){var _this=this,xAxis=_this.content.xAxes[item.xAxis||0]||_this.content.xAxes[0];item.ready=false;item.dataProvider.range(xAxis.scale.inputMin,xAxis.scale.inputMax)},_runProcessors:function(){var _this=this,xAxes=_this.content.xAxes,yAxes=_this.content.yAxes,items=_this.content.items;for(var xAxisNo=0,l=xAxes.length;xAxisNo<l;++xAxisNo){var xAxis=xAxes[xAxisNo];for(var i=0;i<xAxis.items.length;++i){xAxis.items[i].renderData=xAxis.items[i].data}for(var j=0,m=xAxis.processors.length;j<m;++j){xAxis.processors[j].run(xAxis.items)}}for(var yAxisNo=0,l=yAxes.length;yAxisNo<l;++yAxisNo){var yAxis=yAxes[yAxisNo];for(var j=0,m=yAxis.processors.length;j<m;++j){yAxis.processors[j].run(yAxis.items)}for(var k=0;k<yAxis.items.length;++k){yAxis.items[k].trigger("renderData")}}},_beforeRender:function(){this._runProcessors()},_afterRender:function(){},renderItem:function(itemNo){if(this._init!=-1){return}this.render()}}})(jQuery,Vis);(function(Vis){Vis.blocks["i-tango-color-scheme"]={colors:["#73d216","#edd400","#3465a4","#cc0000","#75507b","#f57900","#babdb6","#c17d11"],get:function(i){return this.colors[i%this.colors.length]}}})(Vis);(function(Vis){Vis.blocks["i-static-range-provider"]={init:function(params){this.params=params},get:function(){return{min:this.params.min||0,max:this.params.max||1}},on:function(){}}})(Vis);(function(Vis){Vis.blocks["i-time-range-provider"]={init:function(params){var _this=this,timeRangeProvider=_this.timeRangeProvider=params.timeRangeProvider;timeRangeProvider.on("update.vis",function(){_this.range=timeRangeProvider.get();$(_this).trigger("update.vis")});_this.range=timeRangeProvider.get()},on:function(action,callback){$(this).on(action+".vis",callback)},get:function(){return this.range}}})(Vis);(function(Vis){Vis.blocks["i-current-time-range-provider"]={init:function(params){this.period=params.period||3600;this.delay=params.delay||1e3;this._notify()},get:function(){var now=+new Date/1e3;return{min:now-this.period,max:now}},on:function(action,callback){$(this).on(action+".vis",callback)},_notify:function(){var _this=this;setTimeout(function(){$(_this).trigger("update.vis");_this._notify()},_this.delay)}}})(Vis);(function(Vis){Vis.blocks["i-data-range-provider"]={init:function(params){var _this=this;this.params=params;this.xy=params.xy;this.items=params.items;for(var i=0,l=this.items.length;i<l;++i){this.items[i].on("renderData",function(){_this.calculate()})}this.calculate()},on:function(action,callback){$(this).on(action+".vis",callback)},calculate:function(){var minSliceName=this.params.minSliceName,maxSliceName=this.params.maxSliceName,shiftSliceName=this.params.shiftSliceName,min=Number.POSITIVE_INFINITY,max=Number.NEGATIVE_INFINITY;typeof minSliceName!=="undefined"||(minSliceName=this.xy);typeof maxSliceName!=="undefined"||(maxSliceName=this.xy);typeof shiftSliceName!=="undefined"||(shiftSliceName="shift");for(var i=0,l=this.items.length;i<l;++i){var item=this.items[i],minData=item.renderData[minSliceName]||[],maxData=item.renderData[maxSliceName]||[],shiftData=item.renderData[shiftSliceName]||[];var m=Math.max(minData.length,maxData.length);for(var j=0;j<m;++j){var s=shiftData[j]||0,ymin=minData[j],ymax=maxData[j];typeof ymin!=="undefined"||(ymin=0);typeof ymax!=="undefined"||(ymax=0);if(ymin!==null&&min>ymin+s){min=ymin+s}if(ymax!==null&&max<ymax+s){max=ymax+s}}}if(min==Number.POSITIVE_INFINITY){min=0}if(min>max){max=min+1}this.range={min:min,max:max};$(this).trigger("update.vis")},get:function(){return this.range}}})(Vis);(function(Vis){Vis.blocks["i-scale-linear"]={update:function(){var inputMin=this.inputMin;var outputMin=this.outputMin;var factor=(this.outputMax-outputMin)/(this.inputMax-inputMin);this.f=function f(x){return outputMin+(x-inputMin)*factor};this.fInv=function fInv(x){return inputMin+(x-outputMin)/factor}},input:function(min,max){if(min==max){if(min>=0&&min-1>=0){this.inputMin=min-1;this.inputMax=min+2}else if(min>=0&&min-1<0){this.inputMin=0;this.inputMax=min>0?3*min:1}else if(min<0){this.inputMin=min-2;this.inputMax=min+1}}else if(min>max){console.log("i-scale-linear.input: min > max;",{min:min,max:max});this.inputMax=min;this.inputMin=max}else{this.inputMin=min;this.inputMax=max}this.update()},output:function(min,max){if(min>=max){console.log("i-scale-linear.output: min >= max;",{min:min,max:max});this.outputMax=min;this.outputMin=max}else{this.outputMin=min;this.outputMax=max}this.update()},f:function(x){return undefined},fInv:function(x){return undefined},ticks:function(n,units){var range=this.inputMax-this.inputMin;var delta=range/n;if(units=="unixtime"&&range>2*24*60*60){return this.dayTicks(n)}var factor,volume;if(units=="unixtime"){factor=1;volume=60;if(delta>.8*factor*volume){factor*=volume;volume=60}if(delta>.8*factor*volume){factor*=volume;volume=24}}else{var l=Math.ceil(Math.log(delta)/Math.log(10));factor=Math.pow(10,l-2);volume=100}delta/=factor;var rounded_delta=Math.round(delta),diff=0;for(var i=1;i<volume;++i){if(rounded_delta<=delta){diff=Math.floor(i/2)}else{diff=-Math.floor(i/2)}rounded_delta=Math.round(delta)+diff;if(volume%rounded_delta===0){break}}delta=rounded_delta*factor;var result=[],xMin=Math.ceil(this.inputMin/delta)*delta,xMax=Math.floor(this.inputMax/delta)*delta,x=xMin,steps=Math.round((xMax-xMin)/delta)+1;for(i=0;i<steps;++i){result.push(x);x+=delta}return result},dayTicks:function(n){var range=this.inputMax-this.inputMin;var minD=new Date(this.inputMin*1e3);var maxD=new Date(this.inputMax*1e3);var d=new Date(this.inputMin*1e3);d.setHours(0);d.setMinutes(0);d.setSeconds(0);d.setMilliseconds(0);var result=[];while(+d<=+maxD){if(+d<+minD){d.setDate(d.getDate()+1);continue}result.push(+d/1e3);d.setDate(d.getDate()+1)}return result},format:function(x){var absx=Math.abs(x);var v;if(absx<1){var p=Math.floor(Math.log(absx)/Math.log(10));var d=Math.pow(10,-p+2);if(d==Infinity){v=0}else{v=Math.round(x*d)/d}}else{v=Math.round(x*100)/100}return String(v)}}})(Vis);(function(Vis){Vis.blocks["i-static-data-provider"]={init:function(params){this.params=params},on:function(action,callback){},get:function(){return{x:this.params.x,y:this.params.y}}}})(Vis);(function(Vis){Vis.blocks["i-math-data-provider"]={init:function(params){var _this=this,timeRangeProvider=_this.timeRangeProvider=params.timeRangeProvider;_this.params=params;timeRangeProvider.on("update.vis",function(){_this.range=timeRangeProvider.get();$(_this).trigger("update.vis")});_this.range=timeRangeProvider.get()},on:function(action,callback){$(this).on(action+".vis",callback)},get:function(){var tbegin=this.range.min,tend=this.range.max;var step=this.params.step||1;var f=this[this.params.func||"sin"]||this.sin;var factor=this.params.factor||1;var t=Math.ceil(tbegin/step)*step;var i=0;var length=Math.floor((tend-t)/step);var xData=new Array(length);var yData=new Array(length);while(t<tend){var tmp=f.call(this,t*factor);xData[i]=tmp.x;yData[i]=tmp.y;t+=step;i+=1}return{x:xData,y:yData}},sin:function(t){return{x:t,y:Math.sin(t)}},cos:function(t){return{x:t,y:Math.cos(t)}},sin2:function(x){return{x:t,y:Math.pow(Math.sin(t),2)}},cos2:function(x){return{x:t,y:Math.pow(Math.cos(t),2)}},lissajous:function(t){return{x:Math.sin(this.params.a*t),y:Math.sin(this.params.b*t)}},demo1:function(t){var a=.05;return{x:t,y:1.5*Math.sin(51*a*t)+-1.4*Math.sin(21*a*t)+1.3*Math.sin(11*a*t)+-1.2*Math.sin(9*a*t)+1.1*Math.sin(2*a*t)+5*Math.sin(1.73205*a*t)+Math.sin(a*t)+7*Math.sin(.707106*a*t)+Math.sin(.6*a*t)+10*Math.sin(.1*a*t)+11*Math.sin(.223606*a*t)+7*Math.sin(.173205*a*t)+5*Math.sin(.141421*a*t)+20*Math.sin(.02*a*t)+5*Math.sin(.03*a*t)+20*Math.sin(.025*a*t)+11*Math.sin(.015877*a*t)+17*Math.sin(.00294565*a*t)+19*Math.sin(977518e-9*a*t)+11*Math.sin(305185e-10*a*t)}}}})(Vis);(function($,Vis){Vis.blocks["i-hammy-data-provider"]={init:function(params){var _this=this,timeRangeProvider=_this.timeRangeProvider=params.timeRangeProvider;_this.url=params.url;_this.host=params.host;_this.key=params.key;timeRangeProvider.on("update.vis",function(){_this.range=timeRangeProvider.get();_this.fetchData()});_this.range=timeRangeProvider.get();_this.fetchData()},on:function(action,callback){$(this).on(action+".vis",callback)},fetchData:function(){var _this=this,tBegin=_this.range.min,tEnd=_this.range.max;$.ajax(_this.url,{data:{host:_this.host,key:_this.key,from:tBegin,to:tEnd},dataType:"json",success:function(data){_this.xData=data.X,_this.yData=data.Y;$(_this).trigger("update.vis")}})},get:function(){var tBegin=this.range.min,tEnd=this.range.max,xData=this.xData||[],yData=this.yData||[];var x=[],y=[];for(var i=0;i<xData.length;++i){if(tBegin<=xData[i]&&xData[i]<=tEnd){x.push(xData[i]);y.push(yData[i])}}return{x:x,y:y}}}})(jQuery,Vis);(function(Vis){"use strict";Vis.blocks["i-average-filter"]={init:function(params){this.params=params||{}},run:function(item,data){var xSliceName=this.params.xSliceName||"x",ySliceName=this.params.ySliceName||"y",step=this.params.step||300;var xSlice=data[xSliceName]||[];var ySlice=data[ySliceName]||[];if(xSlice.length===0){return data}var xResult=[],yResult=[];var px=Math.floor(xSlice[0]/step)*step;var py=ySlice[0];var n=1;for(var j=1;j<xSlice.length;++j){var x=xSlice[j],y=ySlice[j];var sx=Math.floor(x/step)*step;if(sx!=px){xResult.push(px+step/2);yResult.push(py/n);py=0;n=0}px=sx;py+=y;n+=1}xResult.push(px+step/2);yResult.push(py/n);data[xSliceName]=xResult;data[ySliceName]=yResult;return data}}})(Vis);(function(Vis){"use strict";Vis.blocks["i-average-processor"]={init:function(params){this.params=params||{}},run:function(items){var xSliceName=this.params.xSliceName||"x",ySliceName=this.params.ySliceName||"y",width=this.params.dimensions.width,factor=this.params.factor||1;for(var i=0,l=items.length;i<l;++i){var scale=items[i].xAxis.scale;var step=(scale.inputMax-scale.inputMin)/width*factor;var renderData=items[i].renderData;var xSlice=renderData[xSliceName]||[];var ySlice=renderData[ySliceName]||[];if(xSlice.length===0){continue}var xResult=[],yResult=[];var px=Math.floor(xSlice[0]/step)*step;var py=ySlice[0];var n=1;for(var j=1;j<xSlice.length;++j){var x=xSlice[j],y=ySlice[j];var sx=Math.floor(x/step)*step;if(sx!=px){xResult.push(px+step/2);yResult.push(py/n);py=0;n=0}px=sx;py+=y;n+=1}xResult.push(px+step/2);yResult.push(py/n);renderData[xSliceName]=xResult;renderData[ySliceName]=yResult}}}})(Vis);(function($,Vis){Vis.blocks["b-chart"]=Vis.extend(Vis.blocks["i-chart"],{init:function(params){var _this=this;params=params||{};this.uniqId=Vis.uniqId();this.$object=params.$object;this.__base.init.apply(this,arguments);this.renderObjects();this.initOverlays();this.initLayers();this.updateDimensions();$(window).bind("resize",function(){TaskScheduler.run(TaskScheduler.PRIO_SYSTEM,[function(sched){_this.updateDimensions();sched.next()}],{id:_this.uniqId+".resize"})})},updateXAxisRange:function(xAxisNo){var _this=this,xAxes=_this.content.xAxes,xAxis=xAxes[xAxisNo]},renderXAxis:function(xAxisNo,ticks){var _this=this,content=_this.content,xAxes=content.xAxes,xAxis=xAxes[xAxisNo];if(xAxis.visObject){xAxis.visObject.update(xAxis.pos,ticks)}},renderYAxis:function(yAxisNo,ticks){var _this=this,content=_this.content,yAxes=content.yAxes,yAxis=yAxes[yAxisNo];if(yAxis.visObject){yAxis.visObject.update(yAxis.pos,ticks)}},initOverlays:function(){var _this=this,overlays=_this.content.overlays;for(var i=0,l=overlays.length;i<l;++i){if(typeof overlays[i].bind!=="undefined"){overlays[i].bind()}}},initLayersForOverlay:function(overlayNo){var _this=this,overlays=_this.content.overlays,layers=_this.content.layers,overlay=overlays[overlayNo];request=overlay.layersRequest();var localLayers=[];for(var i=0,l=request.length;i<l;++i){var layer=request[i];var $canvas=$(Vis.render({tag:"canvas",cls:"b-chart__canvas"}));_this.content.$clippedViewport.append($canvas);layer.canvas=$canvas;layer.ctx=layer.canvas.get(0).getContext("2d");localLayers.push(layer);layers.push(layer)}_this.renderTasks.push(function(sched){overlay.draw(sched,localLayers)})},initLayers:function(){var _this=this,overlays=_this.content.overlays;_this.renderTasks=[];_this.renderTasks.push(function(sched){_this._beforeRender();sched.next()});for(var i=0,l=overlays.length;i<l;++i){_this.initLayersForOverlay(i)}_this.renderTasks.push(function(sched){_this._afterRender();sched.next()})},renderXAxes:function(pos,layout,method){var _this=this,content=_this.content,xAxes=content.xAxes;layout.empty();for(var i=0,l=xAxes.length;i<l;++i){var xAxis=xAxes[i];if(xAxis.pos!==pos){continue}var c=Vis.render({tag:"tr",content:{tag:"td",cls:"b-layout__cell",content:{attrs:{style:"height: 30px"},cls:"b-axis"}}});var $c=$(c);layout[method]($c);xAxis.$object=$(".b-axis",$c);xAxis.visObject=Vis.create(xAxis.$object,"b-axis")}},renderYAxes:function(pos,layout,method){var _this=this,content=_this.content,yAxes=content.yAxes;var $tr=$("<tr>");for(var i=0,l=yAxes.length;i<l;++i){var yAxis=yAxes[i];if(yAxis.pos!==pos){continue}var c=Vis.render({tag:"td",cls:"b-layout__cell",content:{attrs:{style:"width: 60px; height: 200px"},cls:"b-axis"}});var $c=$(c);$tr[method]($c);yAxis.$object=$(".b-axis",$c);yAxis.visObject=Vis(yAxis.$object,"b-axis")}layout.empty().append($tr)},render:function(){if(!this.renderTasks){return}TaskScheduler.run(TaskScheduler.PRIO_DATA,this.renderTasks)},renderObjects:function(){var $object=this.$object;$object.html(Vis.render([{cls:"b-chart__header",content:this.title},{tag:"table",cls:"b-9",content:[{tag:"tr",content:[{tag:"td",cls:"b-9__tl",content:""},{tag:"td",cls:"b-9__tc",content:{tag:"table",cls:"b-layout"}},{tag:"td",cls:"b-9__tr",content:""}]},{tag:"tr",content:[{tag:"td",cls:"b-9__ml",content:{tag:"table",cls:"b-layout"}},{tag:"td",cls:"b-9__mc",content:{content:{cls:"b-chart__viewport",content:{cls:"b-chart__clipped-viewport"}}}},{tag:"td",cls:"b-9__mr",content:{tag:"table",cls:"b-layout"}}]},{tag:"tr",content:[{tag:"td",cls:"b-9__bl",content:""},{tag:"td",cls:"b-9__bc",content:{tag:"table",cls:"b-layout"}},{tag:"td",cls:"b-9__br",content:""}]}]}]));this.renderYAxes("left",$(".b-9__ml .b-layout",$object),"prepend");this.renderYAxes("right",$(".b-9__mr .b-layout",$object),"append");this.renderXAxes("top",$(".b-9__tc .b-layout",$object),"prepend");this.renderXAxes("bottom",$(".b-9__bc .b-layout",$object),"append");this.content.$viewport=$(".b-chart__viewport",$object);this.content.$clippedViewport=$(".b-chart__clipped-viewport",$object)},updateDimensions:function(){var _this=this,dim=_this.dimensions;dim.height=200;dim.width=this.content.$viewport.width();this._applySize();var xAxes=this.content.xAxes,yAxes=this.content.yAxes,i,l;for(i=0,l=xAxes.length;i<l;++i){this._renderXAxis(i)}for(i=0,l=yAxes.length;i<l;++i){this._renderYAxis(i)}this.render()},applySize:function(){var _this=this,dim=_this.dimensions,layers=_this.content.layers;this.content.$viewport.css("height",dim.height+"px");for(var i=0,l=layers.length;i<l;++i){var layer=layers[i];layer.canvas.attr("width",dim.width);layer.canvas.attr("height",dim.height);layer.canvas.css("height",dim.height+"px")
}}})})(jQuery,Vis);(function(Vis){Vis.blocks["b-grid-overlay"]={init:function(params){this.params=params},layersRequest:function(){return[{}]},draw:function(sched,layers){var dim=this.params.dimensions,width=dim.width,height=dim.height,content=this.params.content,xAxis=content.xAxes[0],yAxis=content.yAxes[0],canvas=layers[0].canvas,ctx=layers[0].ctx,f,ticks;if(canvas){canvas.css("left","0");canvas.css("width","100%")}ctx.clearRect(0,0,dim.width,dim.height);if(typeof ctx.mozDash!=="undefined"){ctx.mozDash=[2,4]}if(xAxis){f=xAxis.scale.f;ticks=xAxis.ticks;ctx.strokeStyle="rgb(235,235,235)";ctx.lineWidth=1;for(var l=ticks.length,i=0;i<l;++i){var x=Math.round(f(ticks[i]))+.5;ctx.beginPath();ctx.moveTo(x,0);ctx.lineTo(x,height);ctx.stroke()}}if(yAxis){f=yAxis.scale.f;ticks=yAxis.ticks;ctx.strokeStyle="rgb(220,220,220)";ctx.lineWidth=1;for(var l=yAxis.ticks.length,i=0;i<l;++i){var y=height-(Math.round(f(ticks[i]))+.5);ctx.beginPath();ctx.moveTo(0,y);ctx.lineTo(width,y);ctx.stroke()}}if(typeof ctx.mozDash!=="undefined"){ctx.mozDash=null}sched.next()}}})(Vis);(function($,Vis){Vis.blocks["b-render-overlay"]={init:function(params){var _this=this;_this.params=params;_this.render=Vis.create(_this.params,_this.params.renderName||"b-line-render")},layersRequest:function(){var content=this.params.content,items=content.items,request=[];for(var i=0,l=items.length;i<l;++i){request.push({xAxis:items[i].xAxis,yAxis:items[i].yAxis,item:i})}return request},_run:function(sched,layers,itemNo){var _this=this,content=this.params.content,items=content.items;if(itemNo>=items.length){return sched.next()}else if(items[itemNo]._rendered){_this._run(sched,layers,itemNo+1)}else{sched.next(function(sched){_this.drawItem(sched,layers,itemNo)})}},draw:function(sched,layers){this._run(sched,layers,0)},drawItem:function(sched,layers,itemNo){this.render.drawItem(sched,layers,itemNo);this._run(sched,layers,itemNo+1)}}})(jQuery,Vis);(function($,Vis){var units=Units;Vis.blocks["b-tooltip-overlay"]={init:function(params){this.params=params},bind:function(){var _this=this,viewport=_this.params.content.$viewport;var $tooltip=$('<div class="b-tooltip">');$tooltip.hide();var $dot=$("<div>");$dot.css("position","absolute");$dot.css("height","0px");$dot.css("width","0px");$dot.css("border","2px solid #000");$dot.css("border-radius","2px");$dot.css("box-shadow","0 0 0 1px #fff");$dot.hide();_this.$tooltip=$tooltip;_this.$tooltip.appendTo(viewport);_this.$dot=$dot;_this.$dot.appendTo(viewport);viewport.mousemove($.proxy(this.handleMove,this));viewport.mouseleave($.proxy(this.handleLeave,this))},layersRequest:function(){return[]},draw:function(sched,layers){sched.next()},handleMove:function(event){var _this=this,dim=_this.params.dimensions,width=dim.width,height=dim.height,content=_this.params.content,items=content.items,xAxes=content.xAxes,yAxes=content.yAxes,viewport=_this.params.content.$viewport,$tooltip=_this.$tooltip,$dot=_this.$dot;var offset=viewport.offset();var px=event.pageX-offset.left,py=height-(event.pageY-offset.top);var essential=20,dist=essential*essential,nearest;var iters=0;for(var i=0,l=items.length;i<l;++i){var item=items[i],xAxis=xAxes[item.xAxis||0]||xAxes[0],yAxis=yAxes[item.yAxis||0]||yAxes[0],xData=item.renderData.x||[],yData=item.renderData.y||[],shiftData=item.renderData.shift||[],x=xAxis.scale,y=yAxis.scale;var xBegin=x.fInv(px-essential),xEnd=x.fInv(px+essential);var j=Vis.binarySearch(xBegin,xData),m=xData.length;if(j<0){j=-j-1}while(j<m){var xVal=xData[j],yVal=yData[j];shiftVal=shiftData[j]||0;if(xVal>xEnd){break}if(yVal===null){++j;continue}var dx=px-x.f(xVal),dy=py-y.f(yVal+shiftVal),dd=dx*dx+dy*dy;if(dd<dist){dist=dd;nearest={item:i,pos:j}}++j;iters+=1}}if(nearest){var item=items[nearest.item],j=nearest.pos,xAxis=xAxes[item.xAxis||0]||xAxes[0],yAxis=yAxes[item.yAxis||0]||yAxes[0],xData=item.renderData.x||[],yData=item.renderData.y||[],shiftData=item.renderData.shift||[],xVal=xData[j],yVal=yData[j],shiftVal=shiftData[j]||0,xLabel=units.format(xVal,xAxis.units,xAxis.scale);yLabel=units.format(yVal,yAxis.units,yAxis.scale);x=xAxis.scale,y=yAxis.scale;var result=$.colorToRgba(item.color),mixin=$.colorToRgba("#fff"),lvl=.9;result={r:Math.floor((1-lvl)*result.r+lvl*mixin.r),g:Math.floor((1-lvl)*result.g+lvl*mixin.g),b:Math.floor((1-lvl)*result.b+lvl*mixin.b)};var color="rgba("+result.r+","+result.g+","+result.b+",0.8)";result=$.colorToRgba(item.color);mixin=$.colorToRgba("#000");lvl=.2;result={r:Math.floor((1-lvl)*result.r+lvl*mixin.r),g:Math.floor((1-lvl)*result.g+lvl*mixin.g),b:Math.floor((1-lvl)*result.b+lvl*mixin.b)};var borderColor="rgba("+result.r+","+result.g+","+result.b+",0.8)";px=x.f(xVal);py=y.f(yVal+shiftVal);$tooltip.css("background-color",color);$tooltip.css("border-color",borderColor);if(px<.75*width){$tooltip.css("left",px+"px");$tooltip.css("right","auto")}else{$tooltip.css("right",width-px+"px");$tooltip.css("left","auto")}$tooltip.css("bottom",py+"px");$tooltip.text(xLabel+", "+yLabel);$tooltip.show();$dot.css("border-color",item.color);$dot.css("left",px-2+"px");$dot.css("bottom",py-2+"px");$dot.show()}else{$tooltip.hide();$dot.hide()}},handleLeave:function(event){this.$tooltip.hide();this.$dot.hide()}}})(jQuery,Vis);(function($,Vis){Vis.blocks["b-line-render"]={init:function(params){this.params=params},drawItem:function(sched,layers,itemNo){var dim=this.params.dimensions,width=dim.width,height=dim.height,content=this.params.content,item=content.items[itemNo],xAxis=content.xAxes[item.xAxisNo||0]||Vis.error("No x-axis for item #"+itemNo),yAxis=content.yAxes[item.yAxisNo||0]||Vis.error("No y-axis for item #"+itemNo),canvas=layers[itemNo].canvas,ctx=layers[itemNo].ctx,xData=item.renderData.x,yData=item.renderData.y,shiftData=item.renderData.shift||[],xf=xAxis.scale.f,yf=yAxis.scale.f,x,y,prev,i,l,dots,colorMixin=this.params.colorMixin,colorMixinLevel=this.params.colorMixinLevel||.5,mozilla=(navigator.oscpu||"").indexOf("Linux")>0&&navigator.userAgent.indexOf("Firefox")>0;if(canvas){ctx.clearRect(0,0,dim.width,dim.height);canvas.css("left","0");canvas.css("width","100%")}var color=item.color||"rgb(0,0,0)";if(typeof colorMixin!=="undefined"){var colorRgba=$.colorToRgba(color),mixinRgba=$.colorToRgba(colorMixin),lvl=colorMixinLevel;var result={r:Math.floor((1-lvl)*colorRgba.r+lvl*mixinRgba.r),g:Math.floor((1-lvl)*colorRgba.g+lvl*mixinRgba.g),b:Math.floor((1-lvl)*colorRgba.b+lvl*mixinRgba.b),a:colorRgba.a};if(result.a==1){color="rgb("+result.r+","+result.g+","+result.b+")"}else{color="rgba("+result.r+","+result.g+","+result.b+","+result.a+")"}}ctx.strokeStyle=color;ctx.lineWidth=1;i=0;l=xData.length;dots=0;prev=null;while(i<l){if(yData[i]===null){if(dots>0){ctx.stroke()}++i;dots=0;prev=null;continue}x=xf(xData[i])+.5;y=height-(yf(yData[i]+(shiftData[i]||0))+.5);if(prev===null){ctx.beginPath();ctx.moveTo(x,y)}else{ctx.lineTo(x,y)}++dots;if(mozilla&&dots==2e3){ctx.stroke();ctx.beginPath();dots=0;prev=null;continue}prev=yData[i];++i}if(dots>0){ctx.stroke()}}}})(jQuery,Vis);